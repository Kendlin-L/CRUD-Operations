<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Coding Assignment</title>
   <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
</head>
<body  style="overflow-x: hidden;">
  
  <div class="container"> 
  <nav class="navbar navbar-inverse">
  <a class="navbar-brand" href="/">Home</a>
  
    <span class="navbar-toggler-icon"></span>
  </button>

   <ul class="nav navbar-nav">
      <li ><a href="/clients">Clients</a></li>
      <li class="active"><a href="/physio">Physios</a></li>
      <li><a href="/sessions">Sessions</a></li>
      
    </ul>
</nav>
     <div id="bottomParameters" style="display:inline"> 
<div class="input-group mb-3 ">
          
   
         
    <div class="input-group-prepend">
             <select class="custom-select" hidden="true" id="databaseSearchSelect">
                <option value="physio" selected>Email</option>
            </select>
        </div>
       
    <input class="form-control py-2 border-left-0 border" type="search" placeholder="Search by email for physiotherapist ..." id="databaseSearchFilter">   
          <span> 
            <button class="btn btn-primary" style="position: relative; left: 100%; bottom:34px" type="button" id="databaseSearch">Find</button>
             </span>
             <span>
               <button class="btn btn-primary mr-5" data-toggle="modal" style="position: relative; left: 1020px; bottom: 32px" data-target="#addModal">Add</button>
               </span>
</div>

    <!-- Physios Table -->
    <table class="table table-hover table-striped" id="physiosList">
      <thead>
        <tr>  <!-- <tr class="d-flex"> -->
          <th style="width: 20%">_id</th>
           <th style="width: 20%">title</th>
          <th style="width: 20%">first_name</th>
          <th style="width: 20%">surname</th>
           <th style="width: 20%">mobile</th>
            <th style="width: 20%">home_numbers</th>
          <th style="width: 20%">email</th>
          <th class="text-center" style="width: 15%">Options</th>
        </tr>
      </thead>
      <tbody>
        {{#each results}}
        <tr >
             <td style="width: 20%">"{{_id}}"</td>
           <td style="width: 20%">{{title}}</td>
          <td style="width: 20%">{{first_name}}</td>
            <td style="width: 20%">{{surname}}</td>
          <td style="width: 20%">{{mobile}}</td>
           <td style="width: 20%">{{home_phone}}</td>
           <td style="width: 20%">{{email}}</td>
           
          <td class="text-right" style="width: 15%">
              <a href="javascript:void(0);" style="width: 100%" class="btn btn-sm btn-danger view" data-_id="{{ _id }}" data-title="{{title }}"   data-first_name="{{ first_name }}" data-surname="{{ surname }}" data-mobile="{{ mobile }}" data-home_number="{{ home_phone }}"  data-email="{{ email }}" data-address1="{{ address.address_line1 }}" data-address2="{{ address.address_line2 }}"  data-town="{{ address.town }}" data-county="{{ address.county }}" data-eircode="{{ address.eircode }}" >View</a>
           
              <a href="javascript:void(0);" class="btn btn-sm btn-danger update" data-_id="{{ _id }}" data-title="{{title }}"   data-first_name="{{ first_name }}" data-surname="{{ surname }}" data-mobile="{{ mobile }}" data-home_number="{{ home_phone }}"  data-email="{{ email }}" data-address1="{{ address.address_line1 }}" data-address2="{{ address.address_line2 }}"  data-town="{{ address.town }}" data-county="{{ address.county }}" data-eircode="{{ address.eircode }}" >Update</a>

            <a href="javascript:void(0);" style="width: 100%" class="btn btn-sm btn-danger delete" data-_id="{{ _id }}" data-first_name="{{ first_name }}"  data-surname="{{ surname }}">Delete</a>


          </td>
        </tr>
        {{/each}}
      </tbody>
    </table>
    
     
    <form id="addForm" action="/physio" method="POST">
        <div class="modal fade" id="addModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
         <div class="modal-dialog" role="document">
           <div class="modal-content">
             <div class="modal-header">
               <h5 class="modal-title" id="exampleModalLabel">Add New Physio</h5>
               <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                 <span aria-hidden="true">&times;</span>
               </button>
             </div>
             <div class="modal-body">
             <div class="form-group">
                   <input type="text" name="title" class="form-control" placeholder="title" >
               </div>
               <div class="form-group">
                   <input type="text" name="first_name" class="form-control" placeholder="first name" required>
               </div>
               <div class="form-group">
                   <input type="text" name="surname" class="form-control" placeholder="surname" required>
               </div>
               <div class="form-group">
                   <input type="text" name="mobile" class="form-control" placeholder="mobile" required>
               </div>
               <div class="form-group">
                   <input type="text" name="home_phone" class="form-control" placeholder="home phone" required>
               </div>
                <div class="form-group">
                   <input type="text" name="email" class="form-control" placeholder="email" required>
               </div>
               <div class="form-group">
                   <input type="text" name="address_line1" class="form-control" placeholder="address line 1" required>
               </div>
               <div class="form-group">
                   <input type="text" name="address_line2" class="form-control" placeholder="address line 2" >
               </div>
               <div class="form-group">
                   <input type="text" name="town" class="form-control" placeholder="town" required>
               </div>
               <div class="form-group">
                   <input type="text" name="county" class="form-control" placeholder="county" required>
               </div>
               <div class="form-group">
                   <input type="text" name="eircode" class="form-control" placeholder="eircode" required>
               </div>
               
             </div>
             <div class="modal-footer">
               <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
               <button type="submit" class="btn btn-primary">Save</button>
             </div>
           </div>
         </div>
        </div>
    </form>
 
       <div class="modal fade" id="retrieveModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="exampleModalLabel">Physio Details</h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
            <div class="tests">
                  <div  id="_id" ></div>
                  <div  id="title" ></div>
                   <div id="first_name"></div>
                   <div  id="surname" ></div>
                  <div id="mobile"></div>
                    <div id="home_number"></div>
                   <div id="email"></div>
                   <div id="address1"></div>
                   <div id="address2"></div>
                   <div  id="town" ></div>
                  <div id="county"></div>
                   <div id="eircode"></div>
                   
              </div>
            </div>
            <div class="modal-footer">
            
              <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            
            </div>
          </div>
        </div>
       </div>

       <form id="updateForm" action="/physio" method="PUT"> <!-- we can't PUT with HTML form - this is just an attribute  picked up by AjAX -->
       <div class="modal fade" id="updateModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="exampleModalLabel">Update Physiotherapist Details</h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
              <div class="form-group " >
                  <label for="title">Title</label>
                  <input type="text" name="title" class="form-control title " placeholder="title" >
              </div>
              <div class="form-group " >
                  <label for="first_name">First Name</label>
                  <input type="text" name="first_name" class="form-control first_name " placeholder="first name" >
              </div>
               <div class="form-group">
                   <label for="surname">Surname</label>
                   <input type="text" name="surname" class="form-control surname" placeholder="surname" >
               </div>
               <div class="form-group">
                   <label for="mobile">Mobile</label>
                   <input type="text" name="mobile" class="form-control mobile" placeholder="mobile" required>
               </div>
              <div class="form-group">
                  <label for="home_phone">Home Phone</label>
                  <input type="text" name="home_phone" class="form-control home_number" placeholder="home phone" >
              </div>
               <div class="form-group">
                   <label for="email">Email</label>
                   <input type="text" name="email" class="form-control email" placeholder="email" >
               </div>
               <div class="form-group">
                   <label for="address1">Address Line 1</label>
                   <input type="text" name="address1" class="form-control address1" placeholder="address line 1" >
               </div>
               <div class="form-group">
                      <label for="address2">Address Line 2</label>
                   <input type="text" name="address2" class="form-control address2" placeholder="address line 2" >
               </div>
               <div class="form-group">
                      <label for="town">Town</label>
                   <input type="text" name="town" class="form-control town" placeholder="town" >
               </div>
               <div class="form-group">
                      <label for="county">County</label>
                   <input type="text" name="county" class="form-control county" placeholder="county" >
               </div>
               <div class="form-group">
                      <label for="eircode">Eircode</label>
                   <input type="text" name="eircode" class="form-control eircode" placeholder="eircode" >
               </div>
             
            </div>
            <div class="modal-footer">
              <input type="hidden" name="physioId" class="id">
              <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
              <button type="submit" class="btn btn-primary">Update</button>
            </div>
          </div>
        </div>
       </div>
    </form>


        <form id="deleteForm" action="/physio" method="DELETE"> 
        <div class="modal fade" id="deleteModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
            <div class="modal-dialog">
               <div class="modal-content">
                   <div class="modal-header">
                        <h5 class="modal-title" id="myModalLabel">Delete Physio</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                   </div>
                   <div class="modal-body" id = "modal-body">
                        <strong>Are you sure you want to delete this Physio?</strong>
                   </div>
                   <div class="modal-footer">
                        <input type="hidden" name="physioId" class="form-control id" required>
                        <button type="submit" class="btn btn-success">Delete</button>
                   </div>
                </div>
            </div>
        </div>
    </form>

 

    <div class="modal fade" id="deletedAlert" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="alert alert-success" role="alert">
                <strong>Physio Deleted!</strong>
            </div>
        </div>
    </div>
    <div class="modal fade" id="addedAlert" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="alert alert-success" role="alert">
                <strong>Physio Added!</strong>
            </div>
        </div>
    </div>

   </div>
  


<script> $(document).ready(function(){
      var addForm = $("#addForm");
        addForm.submit(function(e){
            e.preventDefault(); // prevent handling the normal form submit click!
            $.ajax({
                type: addForm.attr('method'),
                url:  addForm.attr('action'),
                data: addForm.serialize(), //gets the physio data from form
                success: function (data) {
                    console.log('Update successful!');
                    

                    $('#addedAlert').modal('show');
                    var timer = setTimeout(function() {
                        $(location).attr('href', '/physio') //if successful redirects to the physios
                    }, 3000);
                },
                error: function (data) {
                    console.log('An error occurred.');
                  
                    $('#errorAlert').modal('show');
                    var timer = setTimeout(function() {
                        $(location).attr('href', '/physios')//also if not successful redirect to physios to try again
                    }, 3000);
                },
            });
            $('#addModal').modal('hide');
        });


 

    $('#physiosList').on('click','.view',function(){
      //variables to store data from specific view button
            var physio_id = $(this).data('_id');
             var physio_title = $(this).data('title');
            var physio_home_number = $(this).data('home_number');
            var physio_first_name = $(this).data('first_name');
            var physio_surname = $(this).data('surname');
            var physio_mobile = $(this).data('mobile');
            var physio_email = $(this).data('email');
            var physio_address1 = $(this).data('address1');
            var physio_address2 = $(this).data('address2');
            var physio_town = $(this).data('town');
            var physio_county = $(this).data('county');
            var physio_eircode = $(this).data('eircode');
          
          

         //shows the retirieve modal to view full document data
            $('#retrieveModal').modal('show');
            $('#_id').html("<b>Id:</b> "+physio_id);
            $('#title').html("<b>Title:</b> "+physio_title);
            $('#home_number').html("<b>Home Number:</b> "+physio_home_number);
            $('#first_name').html("<b>First Name:</b> "+physio_first_name);
            $('#surname').html("<b>Surname:</b> "+physio_surname);
            $('#mobile').html("<b>Mobile:</b> "+physio_mobile);
            $('#email').html("<b>Email:</b> "+physio_email)
            $('#address1').html("<b>Address Line 1:</b> "+physio_address1);
            $('#address2').html("<b>Address Line 2:</b> "+physio_address2);
            $('#town').html("<b>Town:</b> "+physio_town);
            $('#county').html("<b>County:</b> "+physio_county);
            $('#eircode').html("<b>Eircode:</b> "+physio_eircode)
           
        });

        $('#physiosList').on('click','.update',function(){
            var client_id = $(this).data('_id');
            var client_title = $(this).data('title')
            var client_first_name = $(this).data('first_name');
            var client_home_number= $(this).data('home_number');
            var client_surname = $(this).data('surname');
            var client_mobile = $(this).data('mobile');
            var client_email = $(this).data('email');
            var client_address1 = $(this).data('address1');
            var client_address2 = $(this).data('address2');
            var client_town = $(this).data('town');
            var client_county = $(this).data('county');
            var client_eircode = $(this).data('eircode');
            ;
            // alert (quotation_id+": "+ quotation_quote+" "+quotation_author);
            $('#updateModal').modal('show');
                $('.id').val(client_id);
                  $('.title').val(client_title)
            $('.first_name').val(client_first_name);
            $('.home_number').val(client_home_number);
            $('.surname').val(client_surname)
            $('.mobile').val(client_mobile);
            $('.email').val(client_email);
            $('.address1').val(client_address1);
            $('.address2').val(client_address2);
            $('.town').val(client_town);
            $('.county').val(client_county);
            $('.eircode').val(client_eircode);
            $('.birth_date').val(client_birth_date);
            $('.parent_guardian').val(client_parent_guardian);
            $('.leave_message').val(client_leave_message);
            $('.registered').val(client_registered);
            $('.doctor').val(client_doctor);
            $('.referred_by').val(client_referred);
        });

        var updateForm = $("#updateForm");
        updateForm.submit(function(e){
            e.preventDefault(); // prevent handling the normal form submit click!
            var id = updateForm.find('input[name="physioId"]').val();   
            var check = updateForm.serialize();
            console.log(check)

            $.ajax({
                type: updateForm.attr('method'),
                url:  updateForm.attr('action')+"/"+id,
                data: updateForm.serialize(), // get data from form!
                success: function (data) {
                    console.log('Update successful!');
                    // make a timed Bootstrap Alert on Success
                    // then re-direct to "/"
                   $('#addedAlert').modal('show');
                    var timer = setTimeout(function() {
                        $(location).attr('href', '/physio')
                    }, 3000);
                },
                error: function (data) {
                    console.log('An error occurred.');
                    // make a timed Bootstrap Alert on Error
                    // then re-direct to "/"
           
                    var timer = setTimeout(function() {
                        $(location).attr('href', '/physio')
                    }, 3000);
                },
            });
            $('#updateModal').modal('hide');
        });

        $('#physiosList').on('click','.delete',function(){
            var physio_id = $(this).data('_id');
            var physio_first_name = $(this).data('first_name');
            var physio_surname = $(this).data('surname');
          
            $("#deleteModal .modal-body").html("Are You Sure You Want to Delete "+physio_first_name+" "+physio_surname+" from Database");
            $('#deleteModal').modal('show');
            $('.id').val(physio_id);
        });

        var deleteForm = $("#deleteForm");
        deleteForm.submit(function(e){
            e.preventDefault();  // prevent handling the normal form submit click!
            var id = deleteForm.find('input[name="physioId"]').val();   
            $.ajax({
                type: deleteForm.attr('method'),
                url:  deleteForm.attr('action')+"/"+id, //id added to / to allow for DELETE request and contoller to work
                success: function (data) {
                    console.log('Deletion successful!');
                    
                    $('#deletedAlert').modal('show');
                    var timer = setTimeout(function() {
                        $(location).attr('href', '/physio')
                    }, 3000);
                },
                error: function (data) {
                    console.log('An error occurred.');
                   
                    $('#errorAlert').modal('show');
                    var timer = setTimeout(function() {
                        $(location).attr('href', '/')
                    }, 3000);
                },
            });
            $('#deleteModal').modal('hide');
        });
        

       
  //query to allow for document to be retrieved by email
        $("#databaseSearch").on('click',function() {
            var search = $("#databaseSearchFilter").val().replace(/[|&;$%@"<>()+,^  ]/g, "");
            if (search) {
                $(location).attr('href', '/'+$("#databaseSearchSelect").val()+'/'+search);
            } else {
                $(location).attr('href', '/');
            }
        });


        
})
</script>
</body>
</html>

{{!-- RESOURCES USED


  -JQuey/ Ajax functions for Creating, Searching and Deleting based off of 
       -https://www.w3schools.com/bootstrap/bootstrap_navbar.asp
       -https://www.w3schools.com/bootstrap/
      


 --}}